{"version":3,"sources":["webpack:///./src/views/roles/components/selectGroup.vue?aea3","webpack:///./src/views/roles/roles.vue?fc41","webpack:///./src/views/roles/components/selectGroup.vue?2498","webpack:///./src/views/roles/config/resloveMenu.js","webpack:///src/views/roles/components/selectGroup.vue","webpack:///./src/views/roles/components/selectGroup.vue?5fb0","webpack:///./src/views/roles/components/selectGroup.vue","webpack:///./src/api/roles/index.js","webpack:///src/views/roles/roles.vue","webpack:///./src/views/roles/roles.vue?e596","webpack:///./src/views/roles/roles.vue","webpack:///./src/views/roles/roles.vue?f315"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","ref","attrs","headers","pageAPI","deleteAPI","on","editRow","add","visibleDialog","title","columns","loading","form","$event","submit","scopedSlots","_u","key","fn","staticStyle","totalMenus","matchMenu","model","value","callback","$$v","menuDtos","expression","proxy","_e","staticRenderFns","_l","menuItem","code","isIndeterminate","handleCheckAllChange","$set","_v","_s","name","sonMenus","length","handleCheckedSingleChange","sonMenu","id","getFilterName","flatArr","arr","result","forEach","item","children","push","matchSelectMenu","selectMenu","need","index","navName","businessCode","imgUrl","description","check","checkArr","selectItem","getSetMenu","allMenu","menuConfig","menuData","getSubmitMenu","menu","submitMenu","menuC","JSON","parse","stringify","props","menuOptionsOrg","type","Array","default","mactchMenus","prop","event","created","menuOptions","data","mounted","$nextTick","export","methods","map","checkedCount","$emit","replace","component","params","http","url","method","addAPI","updateAPI","getRoleMenuAPI","listAPI","components","activeName","roles","label","getRoles","getRoleMenus","row","api","saveForm","$message","error","getMenus","menus","toString"],"mappings":"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","file":"static/js/chunk-0a513dbc.838fdf23.js","sourcesContent":["export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./selectGroup.vue?vue&type=style&index=0&id=b907ee76&lang=scss&scoped=true&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"tabs-box\"},[_c('common-table',{ref:\"table\",attrs:{\"headers\":_vm.headers,\"api\":_vm.pageAPI,\"deleteApi\":_vm.deleteAPI,\"settings\":['setting']},on:{\"editRow\":_vm.editRow,\"add\":_vm.add}}),(_vm.visibleDialog)?_c('edit-dialog',{attrs:{\"visibleDialog\":_vm.visibleDialog,\"title\":_vm.title,\"columns\":_vm.columns,\"loading\":_vm.loading,\"form\":_vm.form},on:{\"update:visibleDialog\":function($event){_vm.visibleDialog=$event},\"update:visible-dialog\":function($event){_vm.visibleDialog=$event},\"save\":_vm.submit},scopedSlots:_vm._u([{key:\"menuDtos\",fn:function(){return [_c('el-form-item',{staticStyle:{\"padding-top\":\"5px\"},attrs:{\"label\":\"角色权限\",\"required\":\"\"}},[_c('select-group',{attrs:{\"menuOptionsOrg\":_vm.totalMenus,\"mactchMenus\":_vm.matchMenu},model:{value:(_vm.menuDtos),callback:function ($$v) {_vm.menuDtos=$$v},expression:\"menuDtos\"}})],1)]},proxy:true}],null,false,3822885382)}):_vm._e()],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"select-group\"},_vm._l((_vm.menuOptions),function(menuItem){return _c('div',{key:menuItem.code,staticClass:\"select-group-item\"},[_c('el-checkbox',{attrs:{\"indeterminate\":menuItem.isIndeterminate},on:{\"change\":function($event){return _vm.handleCheckAllChange($event, menuItem)}},model:{value:(menuItem.check),callback:function ($$v) {_vm.$set(menuItem, \"check\", $$v)},expression:\"menuItem.check\"}},[_vm._v(_vm._s(menuItem.name))]),(menuItem.sonMenus && menuItem.sonMenus.length)?_c('el-checkbox-group',{on:{\"change\":function($event){return _vm.handleCheckedSingleChange($event, menuItem)}},model:{value:(menuItem.checkArr),callback:function ($$v) {_vm.$set(menuItem, \"checkArr\", $$v)},expression:\"menuItem.checkArr\"}},_vm._l((menuItem.sonMenus),function(sonMenu){return _c('el-checkbox',{key:sonMenu.id,attrs:{\"label\":sonMenu}},[_vm._v(_vm._s(_vm.getFilterName(sonMenu.name)))])}),1):_vm._e()],1)}),0)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","// 将数组里面的children项排出来。固定2层。\r\n/**\r\n * @param {Array} arr\r\n * @param {Array} 拍平后的数组\r\n */\r\nconst flatArr = arr => {\r\n  let result = [];\r\n  arr.forEach(item => {\r\n    if (item.children && item.children.length) {\r\n      result.push(...flatArr(item.children));\r\n    } else if (item.sonMenus && item.sonMenus.length) {\r\n      result.push(...flatArr(item.sonMenus));\r\n    }\r\n    result.push(item);\r\n  });\r\n  return result;\r\n};\r\n\r\n// menuItem 为一个对象。menuConfig为配置项的数组(只有需要显示的项)\r\n/**\r\n * 匹配跳转的菜单\r\n * @param {Array} allMenu 所有的菜单\r\n * @param {Array} menuConfig 需要显示的菜单\r\n * @param {String} path 需要进入的路由地址\r\n * @returns {Boolean} 是否匹配成功，成功可以跳转，不成功不能跳转\r\n */\r\nconst matchJumpMenu = (allMenu, menuConfig, path) => {\r\n  if (path === \"/home\") {\r\n    return true;\r\n  }\r\n  // 所有的菜单.先拍平.目前2层\r\n  let allMenuComp = [];\r\n  allMenu.forEach(menuItem => {\r\n    allMenuComp.push(menuItem);\r\n    if (menuItem.children) {\r\n      allMenuComp.push(...menuItem.children);\r\n    }\r\n  });\r\n  // 先拍平.目前2层\r\n  let menuConfigCopy = [];\r\n  menuConfig.forEach(menuItem => {\r\n    menuConfigCopy.push(menuItem);\r\n    if (menuItem.sonMenus) {\r\n      menuConfigCopy.push(...menuItem.sonMenus);\r\n    }\r\n  });\r\n  // 找出需要跳转的菜单。在全部菜单中肯定能找到的.除了home\r\n  let judgeMenu;\r\n  allMenuComp.forEach(menuItem => {\r\n    if (menuItem.route === path) {\r\n      judgeMenu = menuItem;\r\n    }\r\n  });\r\n  // 是否实际存在。true存在(code对应着菜单的index)\r\n  let isExist = false;\r\n  for (let i = 0; i < menuConfigCopy.length; i++) {\r\n    if (menuConfigCopy[i].code === judgeMenu.index) {\r\n      isExist = true;\r\n      break;\r\n    }\r\n  }\r\n  return !!isExist;\r\n};\r\n/**\r\n * 得到展示的菜单\r\n * @param {Array} allMenu 所有的菜单\r\n * @param {Array} menuConfig 得到需要展示的菜单\r\n * @returns {Array} 左侧展示菜单的数据\r\n */\r\nconst getMenuOptions = (allMenu, menuConfig) => {\r\n  // 需要显示的菜单.先拍平.目前2层\r\n  let menuConfigCopy = [],\r\n    menuIndexArr = [];\r\n  menuConfig.forEach(menuItem => {\r\n    menuConfigCopy.push(menuItem);\r\n    if (menuItem.sonMenus) {\r\n      menuConfigCopy.push(...menuItem.sonMenus);\r\n    }\r\n  });\r\n  // 得到记录code的数组\r\n  menuIndexArr = menuConfigCopy.map(item => item.code);\r\n  allMenu.forEach(menuItem => {\r\n    menuItem.visible = menuIndexArr.includes(menuItem.index);\r\n    // 取服务端的名字.如果默认项里面存在\r\n    if (menuItem.visible) {\r\n      menuItem.navName =\r\n        menuConfigCopy[menuIndexArr.indexOf(menuItem.index)].name;\r\n    }\r\n    if (menuItem.children) {\r\n      menuItem.children.forEach(childMenu => {\r\n        childMenu.visible = menuIndexArr.includes(childMenu.index);\r\n        if (childMenu.visible) {\r\n          childMenu.navName =\r\n            menuConfigCopy[menuIndexArr.indexOf(childMenu.index)].name;\r\n        }\r\n      });\r\n    }\r\n  });\r\n  return allMenu;\r\n};\r\n// 得到code组成的数组\r\n/**\r\n * @param {Array} menus 所有的\r\n * @returns {Array} 返回菜单的权限的code组成的数组\r\n */\r\nconst getMenuCode = menus => {\r\n  let menuC = flatArr(JSON.parse(JSON.stringify(menus)));\r\n  let result = [];\r\n  menuC.length &&\r\n    menuC.forEach(item => {\r\n      result.push(item.code);\r\n    });\r\n  return result;\r\n};\r\n// 得到字符串\r\n/**\r\n * @param {Array} menus 所有的\r\n * @returns {String} 返回菜单的权限的描述的拼接\r\n */\r\nconst getMenuString = menus => {\r\n  let menuC = flatArr(JSON.parse(JSON.stringify(menus)));\r\n  let s = \"\";\r\n  menuC.length &&\r\n    menuC.forEach(item => {\r\n      s += \",\" + item.name;\r\n    });\r\n  if (s) {\r\n    s = s.substring(1);\r\n  } else {\r\n    s = \"--\";\r\n  }\r\n  return s;\r\n};\r\n// 将数组拆成一维数组并且处理是否选中。是递归函数。\r\n/**\r\n * @param {Array} arr 输入数组\r\n * @returns {Array} 编辑匹配后的菜单数据。check，isIndeterminate,checkArr\r\n */\r\nconst matchSelectMenu = (arr, selectMenu) => {\r\n  let result = [];\r\n  arr.forEach(item => {\r\n    let need = {\r\n      code: item.index || item.code,\r\n      // id: item.index,\r\n      //名字需要修改的\r\n      name: item.navName || item.name,\r\n      sonMenus: [],\r\n      businessCode: 1,\r\n      imgUrl: null,\r\n      description: null,\r\n      check: false,\r\n      isIndeterminate: false,\r\n      checkArr: []\r\n    };\r\n    if (item.children) {\r\n      need.sonMenus.push(...matchSelectMenu(item.children, selectMenu));\r\n    }\r\n    if (item.sonMenus) {\r\n      need.sonMenus.push(...matchSelectMenu(item.sonMenus, selectMenu));\r\n    }\r\n    need.sonMenus.forEach(item => {\r\n      if (item.check) {\r\n        need.checkArr.push(item);\r\n      }\r\n    });\r\n    selectMenu.forEach(selectItem => {\r\n      if (selectItem.code === item.index || selectItem.code === item.code) {\r\n        need.check = true;\r\n        need.name = selectItem.name;\r\n        // 含有子项的是否勾选判断\r\n        if (need.sonMenus.length) {\r\n          need.check = need.sonMenus.length === need.checkArr.length;\r\n          need.isIndeterminate = need.sonMenus.length !== need.checkArr.length;\r\n        }\r\n      }\r\n    });\r\n    result.push(need);\r\n  });\r\n  return result;\r\n};\r\n\r\n// 在权限设置页面里面匹配出菜单选项所需要的值。home，login是不要的\r\n/**\r\n * @param {Array} allMenu 所有的菜单\r\n * @param {Array} menuConfig 默认选中的菜单\r\n * @returns {Array} 返回设置权限的（用于渲染）菜单选项\r\n */\r\nconst getSetMenu = (allMenu, menuConfig) => {\r\n  let selectMenu = flatArr(menuConfig);\r\n  let menuData = matchSelectMenu(allMenu, selectMenu);\r\n  return menuData;\r\n};\r\n// 获得提交的菜单数据\r\n/**\r\n * @param {Array} menu 要提交的菜单的原始数据\r\n * @returns {Array} 返回提交的菜单数据\r\n */\r\nconst getSubmitMenu = menu => {\r\n  let submitMenu = [];\r\n  let menuC = JSON.parse(JSON.stringify(menu));\r\n  menuC.forEach(item => {\r\n    if (item.check || item.checkArr.length) {\r\n      let need = {\r\n        code: item.code,\r\n        //名字需要修改的\r\n        name: item.name,\r\n        sonMenus: item.checkArr,\r\n        businessCode: 1,\r\n        imgUrl: null,\r\n        description: null\r\n      };\r\n      submitMenu.push(need);\r\n    }\r\n  });\r\n  return submitMenu;\r\n};\r\n\r\nexport {\r\n  matchJumpMenu,\r\n  getMenuOptions,\r\n  getSetMenu,\r\n  getSubmitMenu,\r\n  getMenuString,\r\n  getMenuCode\r\n};\r\n","<!-- 多选组 -->\r\n<template>\r\n  <div class=\"select-group\">\r\n    <div\r\n      class=\"select-group-item\"\r\n      v-for=\"menuItem in menuOptions\"\r\n      :key=\"menuItem.code\"\r\n    >\r\n      <el-checkbox\r\n        :indeterminate=\"menuItem.isIndeterminate\"\r\n        v-model=\"menuItem.check\"\r\n        @change=\"handleCheckAllChange($event, menuItem)\"\r\n        >{{ menuItem.name }}</el-checkbox\r\n      >\r\n      <el-checkbox-group\r\n        v-if=\"menuItem.sonMenus && menuItem.sonMenus.length\"\r\n        v-model=\"menuItem.checkArr\"\r\n        @change=\"handleCheckedSingleChange($event, menuItem)\"\r\n      >\r\n        <el-checkbox\r\n          v-for=\"sonMenu in menuItem.sonMenus\"\r\n          :label=\"sonMenu\"\r\n          :key=\"sonMenu.id\"\r\n          >{{ getFilterName(sonMenu.name) }}</el-checkbox\r\n        >\r\n      </el-checkbox-group>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { getSetMenu, getSubmitMenu } from \"../config/resloveMenu\";\r\n\r\nexport default {\r\n  props: {\r\n    // 原始的菜单\r\n    menuOptionsOrg: {\r\n      type: Array,\r\n      default: () => []\r\n    },\r\n    //用于匹配已选项目的菜单\r\n    mactchMenus: {\r\n      type: Array,\r\n      default: () => []\r\n    },\r\n    // 用于双向绑定\r\n    value: {\r\n      type: Array,\r\n      default: () => []\r\n    }\r\n  },\r\n  model: {\r\n    prop: \"value\",\r\n    event: \"exportEvent\"\r\n  },\r\n  created() {\r\n    // 获取设置的菜单\r\n    this.menuOptions = getSetMenu(this.menuOptionsOrg, this.mactchMenus);\r\n  },\r\n  data() {\r\n    return {\r\n      menuOptions: []\r\n    };\r\n  },\r\n  mounted() {\r\n    this.$nextTick(this.export);\r\n  },\r\n  methods: {\r\n    handleCheckAllChange(value, menuItem) {\r\n      menuItem.checkArr = value ? menuItem.sonMenus.map(item => item) : [];\r\n      menuItem.isIndeterminate = false;\r\n      this.export();\r\n    },\r\n    handleCheckedSingleChange(value, menuItem) {\r\n      let checkedCount = value.length;\r\n      menuItem.check = checkedCount === menuItem.sonMenus.length;\r\n      menuItem.isIndeterminate =\r\n        checkedCount > 0 && checkedCount < menuItem.sonMenus.length;\r\n      this.export();\r\n    },\r\n    export() {\r\n      this.$emit(\"exportEvent\", getSubmitMenu(this.menuOptions));\r\n    },\r\n    getFilterName(name) {\r\n      return name.replace(\"虹桥-\", \"\");\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.select-group {\r\n  .el-checkbox-group {\r\n    > label {\r\n      margin-left: 30px;\r\n    }\r\n  }\r\n}\r\n</style>\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./selectGroup.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./selectGroup.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./selectGroup.vue?vue&type=template&id=b907ee76&scoped=true&\"\nimport script from \"./selectGroup.vue?vue&type=script&lang=js&\"\nexport * from \"./selectGroup.vue?vue&type=script&lang=js&\"\nimport style0 from \"./selectGroup.vue?vue&type=style&index=0&id=b907ee76&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"b907ee76\",\n  null\n  \n)\n\nexport default component.exports","/*角色管理api*/\r\nimport http from \"@/server/http.js\";\r\n\r\n//列表（分页）\r\nexport const pageAPI = params => {\r\n  return http({\r\n    url: \"/api-customer/account/web/rolesWithPage\",\r\n    method: \"GET\",\r\n    params\r\n  });\r\n};\r\n\r\n//删除\r\nexport const deleteAPI = params => {\r\n  return http({\r\n    method: \"delete\",\r\n    url: `/api-customer/account/web/role?roleId=${params.id}`\r\n  });\r\n};\r\n\r\n// 新增\r\nexport const addAPI = data => {\r\n  return http({\r\n    method: \"POST\",\r\n    url: `/api-customer/account/web/role`,\r\n    data\r\n  });\r\n};\r\n\r\n// 编辑\r\nexport const updateAPI = data => {\r\n  return http({\r\n    method: \"PUT\",\r\n    url: `/api-customer/account/web/role`,\r\n    data\r\n  });\r\n};\r\n\r\n// 权限菜单\r\nexport const getRoleMenuAPI = () => {\r\n  return http({\r\n    method: \"get\",\r\n    url: `/api-customer/account/web/menus/my`\r\n  });\r\n};\r\n\r\n// 列表查询\r\nexport const listAPI = () => {\r\n  return http({\r\n    method: \"GET\",\r\n    url: \"/api-customer/account/web/roles\"\r\n  });\r\n};\r\n","<template>\r\n  <div class=\"tabs-box\">\r\n    <!--<el-tabs v-model=\"activeName\">\r\n      <el-tab-pane name=\"roles\" @click.native=\"activeName = 'roles'\">\r\n        <span slot=\"label\" style=\"padding: 0 6px\">角色管理</span>\r\n\r\n      </el-tab-pane>\r\n    </el-tabs>-->\r\n    <common-table\r\n      ref=\"table\"\r\n      :headers=\"headers\"\r\n      :api=\"pageAPI\"\r\n      :deleteApi=\"deleteAPI\"\r\n      :settings=\"['setting']\"\r\n      @editRow=\"editRow\"\r\n      @add=\"add\"\r\n    ></common-table>\r\n    <edit-dialog\r\n      v-if=\"visibleDialog\"\r\n      :visibleDialog.sync=\"visibleDialog\"\r\n      :title=\"title\"\r\n      :columns=\"columns\"\r\n      :loading=\"loading\"\r\n      :form=\"form\"\r\n      @save=\"submit\"\r\n    >\r\n      <template v-slot:menuDtos>\r\n        <el-form-item label=\"角色权限\" required style=\"padding-top: 5px\">\r\n          <select-group\r\n            :menuOptionsOrg=\"totalMenus\"\r\n            :mactchMenus=\"matchMenu\"\r\n            v-model=\"menuDtos\"\r\n          ></select-group>\r\n        </el-form-item>\r\n      </template>\r\n    </edit-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport CommonTable from \"@/components/commonTable/table\";\r\nimport EditDialog from \"@/components/commonTable/editDialog\";\r\nimport SelectGroup from \"./components/selectGroup\";\r\n\r\nimport {\r\n  pageAPI,\r\n  deleteAPI,\r\n  addAPI,\r\n  updateAPI,\r\n  listAPI,\r\n  getRoleMenuAPI\r\n} from \"@/api/roles/index\";\r\n\r\nexport default {\r\n  name: \"Roles\",\r\n  components: { CommonTable, EditDialog, SelectGroup },\r\n  data() {\r\n    return {\r\n      pageAPI,\r\n      deleteAPI,\r\n      activeName: \"roles\",\r\n      visibleDialog: false,\r\n      loading: false,\r\n      type: \"add\",\r\n      title: \"新增角色\",\r\n      roles: [],\r\n      totalMenus: [],\r\n      matchMenu: [],\r\n      headers: [\r\n        { prop: \"index\", label: \"序号\" },\r\n        { prop: \"name\", label: \"角色名称\", width: \"200px\" },\r\n        { prop: \"menuDtos\", label: \"角色权限\", filter: this.getMenus },\r\n        { prop: \"action\", label: \"操作\", width: 140, fixed: \"right\" }\r\n      ],\r\n      columns: [\r\n        { prop: \"name\", label: \"角色名称\", type: \"text\", required: true },\r\n        {\r\n          prop: \"menuDtos\",\r\n          label: \"角色权限\",\r\n          type: \"custom\",\r\n          required: true,\r\n          cols: 4\r\n        }\r\n      ],\r\n      menuDtos: [],\r\n      form: {\r\n        name: \"\",\r\n        menuDtos: []\r\n      },\r\n      props: {\r\n        children: \"sonMenus\",\r\n        label: \"name\",\r\n        value: \"id\"\r\n      }\r\n    };\r\n  },\r\n  created() {\r\n    this.getRoles();\r\n    this.getRoleMenus();\r\n  },\r\n  methods: {\r\n    getRoles() {\r\n      listAPI().then(res => {\r\n        this.roles = res;\r\n      });\r\n    },\r\n    getRoleMenus() {\r\n      getRoleMenuAPI().then(res => {\r\n        this.totalMenus = res || [];\r\n      });\r\n    },\r\n    editRow(row) {\r\n      this.type = \"edit\";\r\n      this.title = \"编辑角色\";\r\n      this.form = row;\r\n      this.matchMenu = row.menuDtos;\r\n      this.visibleDialog = true;\r\n    },\r\n    add() {\r\n      this.type = \"add\";\r\n      this.title = \"新增角色\";\r\n      this.form = {};\r\n      this.matchMenu = [];\r\n      this.visibleDialog = true;\r\n    },\r\n    submit(form) {\r\n      if (!this.menuDtos.length) {\r\n        this.$message.error(\"请选择角色权限！\");\r\n        return;\r\n      }\r\n      let saveForm = Object.assign(form, { menuDtos: this.menuDtos });\r\n      let api = this.type === \"add\" ? addAPI : updateAPI;\r\n      this.loading = true;\r\n      api(saveForm)\r\n        .then(() => {\r\n          this.$message.success(`${this.title}成功！`);\r\n          this.visibleDialog = false;\r\n          this.$refs.table.refresh();\r\n        })\r\n        .catch(err => {\r\n          this.$message.error(`${this.title}失败：${err}`);\r\n        })\r\n        .finally(() => {\r\n          this.loading = false;\r\n        });\r\n    },\r\n    getMenus(menus) {\r\n      let result = [];\r\n      menus.forEach(menu => {\r\n        result.push(menu.name.replace(\"虹桥-\", \"\"));\r\n      });\r\n      return result.toString();\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n.tabs-box {\r\n  padding: 0 30px 16px;\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./roles.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./roles.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./roles.vue?vue&type=template&id=1fed8f9a&scoped=true&\"\nimport script from \"./roles.vue?vue&type=script&lang=js&\"\nexport * from \"./roles.vue?vue&type=script&lang=js&\"\nimport style0 from \"./roles.vue?vue&type=style&index=0&id=1fed8f9a&scoped=true&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"1fed8f9a\",\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./roles.vue?vue&type=style&index=0&id=1fed8f9a&scoped=true&lang=scss&\""],"sourceRoot":""}