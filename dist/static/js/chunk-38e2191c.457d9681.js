(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-38e2191c"],{1276:function(e,t,a){"use strict";var n=a("d784"),i=a("44e7"),s=a("825a"),o=a("1d80"),r=a("4840"),l=a("8aa5"),c=a("50c4"),u=a("14c3"),d=a("9263"),p=a("d039"),m=[].push,f=Math.min,h=4294967295,b=!p((function(){return!RegExp(h,"y")}));n("split",2,(function(e,t,a){var n;return n="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,a){var n=String(o(this)),s=void 0===a?h:a>>>0;if(0===s)return[];if(void 0===e)return[n];if(!i(e))return t.call(n,e,s);var r,l,c,u=[],p=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),f=0,b=new RegExp(e.source,p+"g");while(r=d.call(b,n)){if(l=b.lastIndex,l>f&&(u.push(n.slice(f,r.index)),r.length>1&&r.index<n.length&&m.apply(u,r.slice(1)),c=r[0].length,f=l,u.length>=s))break;b.lastIndex===r.index&&b.lastIndex++}return f===n.length?!c&&b.test("")||u.push(""):u.push(n.slice(f)),u.length>s?u.slice(0,s):u}:"0".split(void 0,0).length?function(e,a){return void 0===e&&0===a?[]:t.call(this,e,a)}:t,[function(t,a){var i=o(this),s=void 0==t?void 0:t[e];return void 0!==s?s.call(t,i,a):n.call(String(i),t,a)},function(e,i){var o=a(n,e,this,i,n!==t);if(o.done)return o.value;var d=s(e),p=String(this),m=r(d,RegExp),g=d.unicode,v=(d.ignoreCase?"i":"")+(d.multiline?"m":"")+(d.unicode?"u":"")+(b?"y":"g"),y=new m(b?d:"^(?:"+d.source+")",v),w=void 0===i?h:i>>>0;if(0===w)return[];if(0===p.length)return null===u(y,p)?[p]:[];var x=0,_=0,k=[];while(_<p.length){y.lastIndex=b?_:0;var D,O=u(y,b?p:p.slice(_));if(null===O||(D=f(c(y.lastIndex+(b?0:_)),p.length))===x)_=l(p,_,g);else{if(k.push(p.slice(x,_)),k.length===w)return k;for(var R=1;R<=O.length-1;R++)if(k.push(O[R]),k.length===w)return k;_=x=D}}return k.push(p.slice(x)),k}]}),!b)},"1d4b":function(e,t,a){"use strict";function n(){return[{id:1,name:"扣分"},{id:2,name:"豁免"},{id:3,name:"加分"}]}function i(){return[{id:1,name:"扣分"}]}a.d(t,"b",(function(){return n})),a.d(t,"a",(function(){return i}))},2213:function(e,t,a){"use strict";a.d(t,"d",(function(){return i})),a.d(t,"c",(function(){return s})),a.d(t,"a",(function(){return o})),a.d(t,"f",(function(){return r})),a.d(t,"b",(function(){return l})),a.d(t,"e",(function(){return c})),a.d(t,"g",(function(){return u}));var n=a("afaa"),i=function(e){return Object(n["a"])({url:"/api-customer/community/policy/list",method:"GET",params:e})},s=function(e){return Object(n["a"])({url:"/api-customer/community/policy/listAll",method:"GET",params:e})},o=function(e){return Object(n["a"])({method:"POST",url:"/api-customer/community/policy/add",data:e})},r=function(e){return Object(n["a"])({method:"PUT",url:"/api-customer/community/policy/update",data:e})},l=function(e){return Object(n["a"])({method:"PUT",url:"/api-customer/community/policy/enablePolicy",params:e})},c=function(e){return Object(n["a"])({method:"GET",url:"/api-customer/community/policy/relevance",params:e})},u=function(e){return Object(n["a"])({method:"PUT",url:"/api-customer/community/policy/updateRelevance",data:e})}},"4fc6":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tabs-box"},[a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{name:"strategy"},nativeOn:{click:function(t){e.activeName="strategy"}}},[a("span",{staticStyle:{padding:"0 6px"},attrs:{slot:"label"},slot:"label"},[e._v("策略维护")]),a("common-table",{ref:"table",attrs:{headers:e.headers,api:e.pageAPI,params:e.params,columns:e.columns,canDelete:!1,settings:["setting"]},on:{editRow:e.editRow},scopedSlots:e._u([{key:"header-left",fn:function(){return[a("el-button",{attrs:{type:"primary"},on:{click:e.add}},[a("i",{staticClass:"el-icon-plus"}),e._v(e._s(e.title)+" ")]),a("el-button",{on:{click:e.setEva}},[e._v(" 评价设置 ")])]},proxy:!0},{key:"table-header",fn:function(){return[a("table-search",{attrs:{resettable:"",columns:e.searchColumns},on:{search:e.search},model:{value:e.params,callback:function(t){e.params=t},expression:"params"}})]},proxy:!0},{key:"action-prepend",fn:function(t){var n=t.row;return[a("el-button",{attrs:{type:"text"},on:{click:function(t){return e.concatRow(n)}}},[e._v("关联")])]}}])}),e.visibleDialog?a("edit-dialog",{attrs:{visibleDialog:e.visibleDialog,title:e.title,columns:e.columns,loading:e.loading,form:e.form},on:{"update:visibleDialog":function(t){e.visibleDialog=t},"update:visible-dialog":function(t){e.visibleDialog=t},save:e.submit},scopedSlots:e._u([{key:"assessmentPolicyDetail",fn:function(){return[a("form-table",{attrs:{columns:e.formColumns,defaultRow:e.defaultRow,required:["caseDimensionId","assessmentType","singleThreshold"]},on:{change:e.onChange},model:{value:e.form.assessmentPolicyDetail,callback:function(t){e.$set(e.form,"assessmentPolicyDetail",t)},expression:"form.assessmentPolicyDetail"}})]},proxy:!0}],null,!1,4171356792)}):e._e(),a("eva-setting",{attrs:{visibleDialog:e.showEva},on:{"update:visibleDialog":function(t){e.showEva=t},"update:visible-dialog":function(t){e.showEva=t}}}),a("concat-setting",{attrs:{visibleDialog:e.showConcat,data:e.concatData},on:{"update:visibleDialog":function(t){e.showConcat=t},"update:visible-dialog":function(t){e.showConcat=t}}})],1),a("el-tab-pane",{attrs:{name:"keywords"},nativeOn:{click:function(t){e.activeName="keywords"}}},[a("span",{staticStyle:{padding:"0 6px"},attrs:{slot:"label"},slot:"label"},[e._v("关键词维护")]),a("keywords")],1)],1)],1)},i=[],s=(a("99af"),a("4160"),a("c975"),a("a9e3"),a("d3b7"),a("159b"),a("96cf"),a("1da1")),o=a("1892"),r=a("ddde"),l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"table-form-content"},[a("el-table",{staticClass:"form-table",staticStyle:{width:"100%"},attrs:{border:"",data:e.tableData}},[a("el-table-column",{attrs:{type:"index",label:"序号",width:e.indexWidth}}),e._l(e.columns,(function(t){return a("el-table-column",{key:t.prop,attrs:{label:t.label,"min-width":"120px",width:"timeRange"===t.type?"220px":"dateRange"===t.type?"240px":"date"===t.type?"160px":"","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(n){return["text"===t.type?[n.row.isEdit?a("el-input",e._b({staticStyle:{width:"120px"},attrs:{size:"small",disabled:t.disabled},model:{value:n.row[t.prop],callback:function(a){e.$set(n.row,t.prop,a)},expression:"scope.row[column.prop]"}},"el-input",t.props,!1),[t.append?a("template",{slot:"append"},[e._v(" "+e._s(t.append)+" ")]):e._e()],2):a("span",[e._v(" "+e._s(n.row[t.prop])+" "),t.append?a("span",[e._v(e._s(t.append))]):e._e()])]:e._e(),"select"===t.type||"select-multiple"===t.type?[n.row.isEdit?a("form-select",e._b({attrs:{multiple:"select-multiple"===t.type&&0===n.$index,options:n.row.options&&n.row.options[t.prop]||t.options,disabled:t.disabled},on:{change:function(a){return e.onChange(t.prop,a,n)}},model:{value:n.row[t.prop],callback:function(a){e.$set(n.row,t.prop,a)},expression:"scope.row[column.prop]"}},"form-select",t.props,!1)):a("select-label",{attrs:{keyId:n.row[t.prop],data:n.row.options&&n.row.options[t.prop]||t.options}})]:e._e(),"date"===t.type?[n.row.isEdit?a("el-date-picker",e._b({attrs:{size:"small","value-format":"timestamp"},model:{value:n.row[t.prop],callback:function(a){e.$set(n.row,t.prop,a)},expression:"scope.row[column.prop]"}},"el-date-picker",t.props,!1)):a("span",[e._v(" "+e._s(e._f("timeFormat")(n.row[t.prop]))+" ")])]:e._e(),"dateRange"===t.type?[n.row.isEdit?a("el-date-picker",e._b({attrs:{size:"small",type:"daterange","value-format":"timestamp","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",disabled:t.disabled},on:{change:function(a){return e.onChange(t.prop,a,n)}},model:{value:n.row[t.prop],callback:function(a){e.$set(n.row,t.prop,a)},expression:"scope.row[column.prop]"}},"el-date-picker",t.props,!1)):a("span",[e._v(" "+e._s(e._f("timeFormat")(n.row[t.prop][0]))+" 至 "+e._s(e._f("timeFormat")(n.row[t.prop][1]))+" ")])]:e._e(),"timeRange"===t.type?[n.row.isEdit?a("el-time-picker",{attrs:{"is-range":"",size:"small","value-format":"HH:mm","picker-options":{format:"HH:mm"},"range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",placeholder:"选择时间范围"},on:{change:function(a){return e.onChange(t.prop,a,n)}},model:{value:n.row[t.prop],callback:function(a){e.$set(n.row,t.prop,a)},expression:"scope.row[column.prop]"}}):a("span",[e._v(" "+e._s(n.row[t.prop][0])+" 至 "+e._s(n.row[t.prop][1])+" ")])]:e._e(),"org"===t.type?[n.row.isEdit?a("cb-select",{attrs:{disabled:!n.row.isEdit},on:{input:function(a){return e.onChange(t.prop,a,n)}},model:{value:n.row[t.prop],callback:function(a){e.$set(n.row,t.prop,a)},expression:"scope.row[column.prop]"}}):a("span",[e._v(" "+e._s(e.getOrgNameById(n.row[t.prop],e.baseOrgs))+" ")])]:e._e(),"custom"===t.type?[e._t(t.prop,null,{data:{scope:n,column:t}})]:e._e()]}}],null,!0)})})),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isEdit?[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.saveRow(t.row)}}},[e._v("保存")]),t.row.isAdd?e._e():a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.cancelRow(t.row)}}},[e._v("取消")])]:a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.rowEdit(t.row,t)}}},[e._v("编辑")]),!t.row.isEdit||t.row.isAdd?a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.deleteRow(t.row,t.$index)}}},[e._v("删除 ")]):e._e()]}}])})],2),a("div",{staticStyle:{padding:"10px 0"}},[e.isAdding?e._e():a("el-button",{staticStyle:{width:"100%"},attrs:{icon:"el-icon-plus"},on:{click:e.addRow}},[e._v(" "+e._s(e.addTitle)+" ")])],1)],1)},c=[],u=(a("a434"),a("2422")),d=a("eb96"),p=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",{staticClass:"select-label"},[e._v(e._s(e.label))])},m=[],f=(a("b0c0"),{name:"selectLabel",props:{keyId:{},data:{},defaultLabel:{type:String,default:"--"}},data:function(){return{label:""}},watch:{data:{deep:!0,handler:function(){this.loadLabel()}},keyId:function(){this.loadLabel()}},created:function(){this.loadLabel()},methods:{loadLabel:function(){var e=this;this.label=this.defaultLabel,Array.isArray(this.keyId)?(this.label="",this.data&&this.data.length&&this.keyId.forEach((function(t){e.data.forEach((function(a){Number(t)===a.id&&(e.label?e.label+=","+a.name:e.label=a.name)}))})),this.label||(this.label=this.defaultLabel)):(this.keyId||0===this.keyId)&&this.data&&this.data.length&&this.data.forEach((function(t){Number(e.keyId)===t.id&&(e.label=t.name)}))}}}),h=f,b=a("2877"),g=Object(b["a"])(h,p,m,!1,null,null,null),v=g.exports,y=(a("ac1f"),a("1276"),a("2909"));function w(e,t){var a="",n=function t(n){for(var i=0;i<n.length;i++){if(n[i].id===e)return void(a=n[i].name);n[i].children&&n[i].children.length&&t(n[i].children)}};return n(t),a}var x={name:"flowFormTable",components:{FormSelect:u["a"],CbSelect:d["a"],SelectLabel:v},props:{value:{},columns:{type:Array,default:function(){return[]}},defaultRow:{type:Object,default:function(){return{}}},indexWidth:{type:String,default:"50px"},addTitle:{type:String,default:"添加设置"},docType:{type:String},employees:{type:Array,default:function(){return[]}},employeeTypes:{type:Array,default:function(){return[]}},required:{type:Array,default:function(){return[]}}},data:function(){return{getOrgNameById:w,isAdding:!1,baseOrgs:[],tableData:[]}},watch:{value:{immediate:!0,deep:!0,handler:function(e){this.tableData=this.getData(e)}},tableData:{deep:!0,handler:function(e){this.$emit("input",e)}}},created:function(){this.baseOrgs=this.$store.state.auth.baseOrgList},methods:{getData:function(e){var t=e||[];return t.forEach((function(e){e.isEdit||(e.isEdit=0)})),t.length||(this.isAdding=!1),t},reset:function(){this.isAdding=!1},addRow:function(){var e=JSON.parse(JSON.stringify(Object.assign({isEdit:1,isAdd:1},this.defaultRow)));this.tableData.push(e),console.log(this.tableData,this.defaultRow),this.isAdding=!0},rowEdit:function(e){e.isEdit=1,delete e.editRow,e.editRow=Object.assign({},e)},saveRow:function(e){var t=!0;this.required.forEach((function(a){""!==e[a]&&void 0!==e[a]&&null!==e[a]&&e[a]!==[]||(t=!1)})),t?(e.isEdit=0,e.isAdd=0,e.editRow={},this.getRowName(e),this.isAdding=!1):this.$message.error("请将信息填写完整后保存！")},getRowName:function(e){e.orgId&&!e.orgName&&(e.orgName=w(e.orgId,this.baseOrgs))},cancelRow:function(e){e=Object.assign(e,e.editRow),e.isEdit=0,this.isAdding=!1},deleteRow:function(e,t){var a=this;this.$confirm("确定要删除吗？").then((function(){a.tableData.splice(t,1),a.isAdding=!1})).catch((function(){a.isAdding=!1}))},onChange:function(e,t,a){this.$emit("change",e,t,a.row)}}},_=x,k=(a("6122"),Object(b["a"])(_,l,c,!1,null,"d492e59a",null)),D=k.exports,O=a("6208"),R=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"keywords"},[a("common-table",{ref:"table",attrs:{headers:e.headers,api:e.pageAPI,params:e.params,columns:e.columns,deleteApi:e.deleteAPI,uploadURL:"/api-customer/community/keyword/import",modelUrl:"",settings:["setting","upload"]},on:{editRow:e.editRow,add:e.add},scopedSlots:e._u([{key:"table-header",fn:function(){return[a("table-search",{attrs:{resettable:"",columns:e.searchColumns},on:{search:e.search},model:{value:e.params,callback:function(t){e.params=t},expression:"params"}})]},proxy:!0}])}),a("edit-dialog",{attrs:{visibleDialog:e.visibleDialog,title:e.title,columns:e.columns,loading:e.loading,form:e.form},on:{"update:visibleDialog":function(t){e.visibleDialog=t},"update:visible-dialog":function(t){e.visibleDialog=t},save:e.submit},scopedSlots:e._u([{key:"caseDimensionId",fn:function(t){var n=t.form;return[a("form-select",{attrs:{options:e.columns[0].options},on:{change:function(t){return e.dimensionChange(t,"form")}},model:{value:n.caseDimensionId,callback:function(t){e.$set(n,"caseDimensionId",t)},expression:"form.caseDimensionId"}})]}}])})],1)},C=[],E=a("ed08"),S=a("9306"),I={name:"case",components:{CommonTable:o["a"],EditDialog:r["a"],FormSelect:u["a"],TableSearch:O["a"]},data:function(){return{pageAPI:S["d"],deleteAPI:S["b"],visibleDialog:!1,loading:!1,type:"add",title:"新增关键词",case:[],allCaseReasons:[],params:{caseDimensionId:""},searchColumns:[{prop:"caseDimensionId",label:"案件维度",type:"select",options:[]},{prop:"caseReasonId",label:"报案缘由",type:"select",options:[]},{prop:"keyword",label:"关键词",type:"input"}],searchOptions:{},headers:[{prop:"index",label:"序号"},{prop:"caseDimensionName",label:"案件维度"},{prop:"caseReasonName",label:"报案缘由"},{prop:"keyword",label:"关键词"},{prop:"updateTime",label:"修改时间",type:"date"},{prop:"userName",label:"添加人"},{prop:"action",label:"操作",width:100,fixed:"right"}],columns:[{index:0,prop:"caseDimensionId",label:"案件维度",required:!0,options:[]},{index:1,prop:"caseReasonId",label:"报案缘由",type:"select",required:!0,options:[]},{index:2,prop:"keyword",label:"关键词",type:"text",required:!0}],form:{caseDimensionId:"",caseReasonId:""}}},watch:{"params.caseDimensionId":function(e){this.dimensionChange(e,"search")}},created:function(){this.getOptions()},methods:{getOptions:function(){this.getCaseDimensions(),this.getCaseReasons()},getCaseDimensions:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(E["b"])("CASE_DIMENSION");case 2:a=t.sent,e.searchColumns[0].options=a,e.columns[0].options=a;case 5:case"end":return t.stop()}}),t)})))()},getCaseReasons:function(e){var t=arguments,a=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){var i,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(i=t.length>1&&void 0!==t[1]?t[1]:"from",s=[],!e){n.next=8;break}return n.next=5,Object(E["a"])(e);case 5:s=n.sent,n.next=12;break;case 8:return n.next=10,Object(E["b"])("CASE_REASON");case 10:s=n.sent,a.allCaseReasons=Object(y["a"])(s);case 12:"form"===i?a.columns[1].options=s:a.searchColumns[1].options=s;case 13:case"end":return n.stop()}}),n)})))()},search:function(){this.$refs.table.onQuery()},editRow:function(e){this.type="edit",this.title="编辑关键词",this.form=e,this.columns[1].options=this.allCaseReasons,this.visibleDialog=!0},add:function(){this.type="add",this.title="新增关键词",this.form={caseDimensionId:"",caseReasonId:""},this.visibleDialog=!0},submit:function(e){var t=this,a=Object.assign({},e);if(this.checkForm(a)){var n="add"===this.type?S["a"]:S["e"];this.loading=!0,n(a).then((function(){t.$message.success("".concat(t.title,"成功！")),t.visibleDialog=!1,t.$refs.table.refresh()})).catch((function(e){t.$message.error("".concat(t.title,"失败：").concat(e))})).finally((function(){t.loading=!1}))}},checkForm:function(e){if(e)return!0},dimensionChange:function(e,t){this.getCaseReasons(e,t),"form"===t?(this.form.caseDimensionId=e,this.form.caseReasonId=""):this.params.caseReasonId=""}}},$=I,j=Object(b["a"])($,R,C,!1,null,null,null),T=j.exports,N=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.visible?a("edit-dialog",{attrs:{visibleDialog:e.visible,title:e.title,form:e.form,columns:e.columns,loading:e.loading},on:{"update:visibleDialog":function(t){e.visible=t},"update:visible-dialog":function(t){e.visible=t},save:e.submit,formUpdate:e.formUpdate},scopedSlots:e._u([{key:"evaluate",fn:function(){return[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.form.evaluate,border:""}},[a("el-table-column",{attrs:{type:"index",label:"序号",width:"50"}}),a("el-table-column",{attrs:{prop:"evaluateName",label:"评价",width:"180"}}),a("el-table-column",{attrs:{prop:"scoreFrom",label:"判断规则"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v("考核得分在：")]),a("el-input-number",{attrs:{min:e.form.evaluate[t.$index+1]?e.form.evaluate[t.$index+1].scoreTo+1:0,max:t.row.scoreTo},model:{value:t.row.scoreFrom,callback:function(a){e.$set(t.row,"scoreFrom",a)},expression:"scope.row.scoreFrom"}}),a("span",{staticStyle:{display:"inline-block",margin:"0 10px"}},[e._v("至")]),a("el-input-number",{attrs:{min:t.row.scoreFrom,max:e.form.evaluate[t.$index-1]?e.form.evaluate[t.$index-1].scoreFrom-1:e.form.totalScore},model:{value:t.row.scoreTo,callback:function(a){e.$set(t.row,"scoreTo",a)},expression:"scope.row.scoreTo"}}),a("span",{staticStyle:{display:"inline-block",margin:"0 10px"}},[e._v("分")])]}}],null,!1,555122127)})],1)]},proxy:!0}],null,!1,2893443033)}):e._e()},P=[],A=a("8215"),F={name:"evaSetting",components:{EditDialog:r["a"]},props:{title:{type:String,default:"评价设置"},visibleDialog:{type:Boolean,default:!1}},data:function(){return{form:{totalScore:100,evaluate:[]},visible:!1,loading:!1,columns:[{index:0,prop:"totalScore",label:"考核总分",type:"num",required:!0,cols:4},{index:1,prop:"evaluate",label:"考核评价",cols:4}]}},watch:{visibleDialog:{immediate:!0,handler:function(e){this.visible=e}},visible:{immediate:!0,handler:function(e){e&&this.loadData(),this.$emit("update:visibleDialog",e)}},"form.totalScore":function(e){this.checkScore(this.form.evaluate,e)}},methods:{loadData:function(){var e=this;Object(A["a"])().then((function(t){e.form=Object.assign(e.form,t)}))},formUpdate:function(e){this.form.totalScore=e.totalScore},submit:function(){var e=this;this.loading=!0,Object(A["c"])(this.form).then((function(){e.$message.success("评价设置更新成功！"),e.visible=!1})).catch((function(t){e.$message.error("评价设置更新失败："+t)})).finally((function(){e.loading=!1}))},checkScore:function(e,t){var a=this;e.forEach((function(n,i){var s=0===i?t:e[i-1].scoreFrom-1;a.checkItem(n,s)}))},checkItem:function(e,t){e.scoreTo=e.scoreTo>t?t:e.scoreTo,e.scoreFrom=e.scoreFrom>e.scoreTo?e.scoreTo:e.scoreFrom}}},L=F,z=Object(b["a"])(L,N,P,!1,null,"1c44c968",null),U=z.exports,V=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.visible?a("edit-dialog",{attrs:{visibleDialog:e.visible,title:e.title,form:e.form},on:{"update:visibleDialog":function(t){e.visible=t},"update:visible-dialog":function(t){e.visible=t},save:e.submit},scopedSlots:e._u([{key:"form-content",fn:function(){return[a("form-transfer",{attrs:{data:e.transferData,loading:e.loading},model:{value:e.communityIdList,callback:function(t){e.communityIdList=t},expression:"communityIdList"}})]},proxy:!0}],null,!1,3293416523)}):e._e()},K=[],q=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"form-transfer"},[a("div",{staticClass:"transfer-box left"},[a("div",{staticClass:"transfer-title"},[e._v(e._s(e.leftTitle))]),a("div",{staticClass:"search-box"},[a("el-input",{attrs:{size:"small",placeholder:"请输入内容"},model:{value:e.search.name,callback:function(t){e.$set(e.search,"name",t)},expression:"search.name"}},[a("i",{staticClass:"el-icon-search el-input__icon",attrs:{slot:"suffix"},slot:"suffix"})])],1),a("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"select-tree",attrs:{data:e.allData,"show-checkbox":"","node-key":e.defaultProps.key,props:e.defaultProps,"filter-node-method":e.filterNode,"default-expanded-keys":e.checkedKeys,"default-checked-keys":e.checkedKeys},on:{"check-change":e.checkChange}})],1),a("div",{staticClass:"transfer-box right"},[a("div",{staticClass:"transfer-title"},[e._v(e._s(e.rightTitle))]),a("div",{staticClass:"search-box"},[a("el-input",{attrs:{size:"small",placeholder:"请输入内容"},model:{value:e.search.selectName,callback:function(t){e.$set(e.search,"selectName",t)},expression:"search.selectName"}},[a("i",{staticClass:"el-icon-search el-input__icon",attrs:{slot:"suffix"},slot:"suffix"})])],1),a("div",{staticClass:"select-list"},[e._l(e.selectData,(function(t){return[a("div",{directives:[{name:"show",rawName:"v-show",value:t[e.defaultProps.label].indexOf(e.search.selectName)>-1||""===e.search.selectName,expression:"\n            item[defaultProps.label].indexOf(search.selectName) > -1 ||\n              search.selectName === ''\n          "}],key:t[e.defaultProps.key],staticClass:"select-item"},[a("div",{staticClass:"text"},[e._v(e._s(t[e.defaultProps.label]))]),a("div",{staticClass:"btn"},[a("el-button",{attrs:{type:"text",icon:"el-icon-close"},on:{click:function(a){return e.delRow(t)}}})],1)])]}))],2)])])},G=[],H=(a("4de4"),a("d81d"),{name:"form-select",props:{value:{},data:{type:Array},leftTitle:{type:String,default:"请选择："},rightTitle:{type:String,default:"已选择："},loading:{type:Boolean,default:!1},defaultProps:{type:Object,default:function(){return{children:"children",label:"name",key:"id",selectKey:"type"}}}},data:function(){return{currentValue:[],search:{name:"",selectName:""},allData:[],filterAllData:[],selectData:[],filterSelectData:[],checkedKeys:[]}},watch:{value:function(){this.currentValue=this.value},data:{deep:!0,handler:function(){this.allData=this.data,this.loadData()}},currentValue:{deep:!0,handler:function(){this.loadData(),this.$emit("input",this.currentValue)}},"search.name":function(e){this.$refs["select-tree"].filter(e)}},created:function(){this.currentValue=this.value,this.allData=this.data,this.loadData()},methods:{loadData:function(){this.selectData=this.checkTreeList(this.allData,this.currentValue),this.checkedKeys=this.selectData.map((function(e){return e.id})),this.$refs["select-tree"]&&this.$refs["select-tree"].setCheckedKeys(this.checkedKeys)},checkTreeList:function(e,t){var a=this;if(!e||!e.length)return[];var n=[];return e.forEach((function(e){t&&t.indexOf(e[a.defaultProps.key])>-1&&(a.defaultProps.selectKey?e[a.defaultProps.selectKey]&&n.push(e):n.push(e)),e[a.defaultProps.children]&&(n=[].concat(Object(y["a"])(n),Object(y["a"])(a.checkTreeList(e[a.defaultProps.children],t))))})),n},delRow:function(e){var t=this;this.currentValue&&this.currentValue.length&&this.currentValue.forEach((function(a,n){a!==e.id||t.currentValue.splice(n,1)}))},checkChange:function(){var e=this.$refs["select-tree"].getCheckedKeys();this.currentValue=e.filter((function(e){return null!=e}))},filterNode:function(e,t){return!e||-1!==t[this.defaultProps.label].indexOf(e)}}}),M=H,J=(a("7d77"),Object(b["a"])(M,q,G,!1,null,"122e098e",null)),B=J.exports,W=a("2213"),Y={name:"concatSetting",components:{EditDialog:r["a"],FormTransfer:B},props:{data:{type:Object,require:!0},title:{type:String,default:"关联设置"},visibleDialog:{type:Boolean,default:!1}},data:function(){return{form:{},visible:!1,communityIdList:[],transferData:[]}},watch:{visibleDialog:{immediate:!0,handler:function(e){this.visible=e}},visible:{immediate:!0,handler:function(e){e&&this.loadData(),this.$emit("update:visibleDialog",e)}}},methods:{loadData:function(){var e=this;this.loading=!0,Object(W["e"])({id:this.data.id}).then((function(t){e.transferData=t.left;var a=[];t.right&&t.right.length&&t.right.forEach((function(e){a.push(e.communityId)})),e.communityIdList=a,e.loading=!1}))},submit:function(){var e=this,t={policyId:this.data.id,communityIdList:this.communityIdList};this.loading=!0,Object(W["g"])(t).then((function(){e.$message.success("策略关联更新成功！"),e.visible=!1})).catch((function(t){e.$message.error("策略关联更新失败："+t)})).finally((function(){e.loading=!1}))}}},Q=Y,X=Object(b["a"])(Q,V,K,!1,null,"0018234b",null),Z=X.exports,ee=a("1d4b"),te={name:"Strategy",components:{CommonTable:o["a"],EditDialog:r["a"],FormTable:D,TableSearch:O["a"],Keywords:T,EvaSetting:U,ConcatSetting:Z},data:function(){return{pageAPI:W["d"],activeName:"strategy",visibleDialog:!1,loading:!1,showEva:!1,showConcat:!1,concatData:{},type:"add",title:"新增策略",strategy:[],params:{},caseReasons:[],headers:[{prop:"index",label:"序号"},{prop:"policyName",label:"策略名称"},{prop:"assessmentPolicyDetail",label:"关联社区",filter:function(e){return e?e.length:0}},{prop:"userName",label:"创建人"},{prop:"updateTime",label:"更新时间",type:"date"},{prop:"action",label:"操作",width:100,fixed:"right"}],searchColumns:[{prop:"policyName",label:"策略名称",type:"input"}],columns:[{index:0,prop:"policyName",label:"策略名称",type:"text",required:!0,cols:4},{index:1,prop:"assessmentPolicyDetail",label:"策略设置",required:!0,cols:4}],form:{assessmentPolicyDetail:[]},defaultRow:{assessmentType:1,options:{caseReasonId:[]}},formColumns:[{prop:"caseDimensionId",label:"案件维度",type:"select",options:[]},{prop:"caseReasonId",label:"报案缘由",type:"select",options:[]},{prop:"assessmentType",label:"考核方式",type:"select",options:Object(ee["a"])()},{prop:"singleThreshold",label:"单次阈值",type:"text",append:"分"},{prop:"percent",label:"评分占比",type:"text",append:"%"}]}},created:function(){this.getOptions()},methods:{getOptions:function(){this.getCaseDimensions(),this.getCaseReasons()},getCaseDimensions:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(E["b"])("CASE_DIMENSION");case 2:a=t.sent,e.formColumns[0].options=a;case 4:case"end":return t.stop()}}),t)})))()},getCaseReasons:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(E["b"])("CASE_REASON");case 2:e.caseReasons=t.sent,e.formColumns[1].options=e.caseReasons;case 4:case"end":return t.stop()}}),t)})))()},search:function(){this.$refs.table.onQuery()},editRow:function(e){var t=this;this.type="edit",this.title="编辑策略";var a=JSON.parse(JSON.stringify(e));a.assessmentPolicyDetail&&a.assessmentPolicyDetail.length&&a.assessmentPolicyDetail.forEach((function(e){e.percent=100*e.scoresPercentage,e.isEdit=0,e.options={caseReasonId:t.caseReasons}})),this.form=a,this.visibleDialog=!0},add:function(){this.type="add",this.title="新增策略",this.form={isSpecCommunityFacilities:0},this.visibleDialog=!0},concatRow:function(e){this.concatData=e,this.showConcat=!0},setEva:function(){this.showEva=!0},stopRow:function(e){var t=this;Object(W["b"])({id:e.id}).then((function(){t.$message.success("状态切换成功！"),t.$refs.table.refresh()})).catch((function(e){t.$message.error("".concat(t.title,"失败：").concat(e))}))},submit:function(e){var t=this,a=Object.assign({},e);if(this.checkForm(a)){var n="add"===this.type?W["a"]:W["f"];this.loading=!0,n(a).then((function(){t.$message.success("".concat(t.title,"成功！")),t.visibleDialog=!1,t.$refs.table.refresh()})).catch((function(e){t.$message.error("".concat(t.title,"失败：").concat(e))})).finally((function(){t.loading=!1}))}},checkForm:function(e){if(!e.assessmentPolicyDetail||!e.assessmentPolicyDetail.length)return!1;var t=0,a=!1,n=!1,i=[];return e.assessmentPolicyDetail.forEach((function(e){e.scoresPercentage=Number(e.percent/100),e.singleThreshold=Number(e.singleThreshold),t+=Number(e.percent),e.isEdit&&(a=!0),i.indexOf(e.caseReasonId)>-1?n=!0:i.push(e.caseReasonId)})),a?(this.$message.error("请先保存所有策略设置明细！"),!1):n?(this.$message.error("相同报案缘由只能设置一次扣分策略！"),!1):100===t||(this.$message.error("策略设置评分占比之和必须为100%！"),!1)},onChange:function(e,t,a){return Object(s["a"])(regeneratorRuntime.mark((function n(){var i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if("caseDimensionId"!==e){n.next=6;break}return n.next=3,Object(E["a"])(t);case 3:i=n.sent,a.caseReasonId="",a.options?a.options.caseReasonId=i:a.options={caseReasonId:i};case 6:case"end":return n.stop()}}),n)})))()}}},ae=te,ne=Object(b["a"])(ae,n,i,!1,null,null,null);t["default"]=ne.exports},6122:function(e,t,a){"use strict";a("b9de")},6208:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"table-search"},[a("div",{directives:[{name:"resize",rawName:"v-resize",value:e.formResize,expression:"formResize"}],ref:"search-form",staticClass:"search-form"},[a("div",{ref:"form-box"},[e._t("default",[a("el-form",{ref:"form",attrs:{model:e.form,inline:!0,"label-width":e.labelWidth}},[e._l(e.columns,(function(t,n){return a("el-form-item",{key:n,attrs:{label:t.label,"label-width":t.labelWidth}},["org"===t.type?a("form-organize",{model:{value:e.form[t.prop],callback:function(a){e.$set(e.form,t.prop,a)},expression:"form[column.prop]"}}):"input"===t.type?a("el-input",e._b({staticClass:"short-width",model:{value:e.form[t.prop],callback:function(a){e.$set(e.form,t.prop,a)},expression:"form[column.prop]"}},"el-input",t.props,!1)):"select"===t.type?a("form-select",e._b({staticClass:"search-select-item",attrs:{options:t.options},model:{value:e.form[t.prop],callback:function(a){e.$set(e.form,t.prop,a)},expression:"form[column.prop]"}},"form-select",t.props,!1)):"date"===t.type||"dateRange"===t.type?a("el-date-picker",e._b({style:{width:"date"===t.type?"215px":""},model:{value:e.form[t.prop],callback:function(a){e.$set(e.form,t.prop,a)},expression:"form[column.prop]"}},"el-date-picker",t.props,!1)):e._t(t.prop,null,{form:e.form})],2)})),e._t("default")],2)])],2)]),a("div",{staticClass:"search-btn"},[e._t("search-btn",[a("el-button",{attrs:{type:"primary"},on:{click:e.search}},[e._v("查 询")]),e.resettable?a("el-button",{on:{click:e.reset}},[e._v("重 置")]):e._e()]),e.showOpen?[!1===e.open?a("el-button",{attrs:{type:"text"},on:{click:function(t){e.open=!0}}},[e._v(" 展开 "),a("i",{staticClass:"el-icon-arrow-down"})]):e._e(),!0===e.open?a("el-button",{attrs:{type:"text"},on:{click:function(t){e.open=!1}}},[e._v(" 收起 "),a("i",{staticClass:"el-icon-arrow-up"})]):e._e()]:e._e()],2)])},i=[],s=(a("4160"),a("159b"),a("2422")),o=a("8604"),r={input:{placeholder:"请输入"},select:{placeholder:"请选择",clearable:!0},date:{placeholder:"选择日期",valueFormat:"timestamp",type:"date"},dateRange:{placeholder:"选择日期",valueFormat:"timestamp",type:"daterange",rangeSeparator:"至",startPlaceholder:"开始日期",endPlaceholder:"结束日期"}},l={name:"tableSearch",components:{FormSelect:s["a"],FormOrganize:o["a"]},props:{value:{},columns:{type:Array},resettable:{type:Boolean,default:!1},labelWidth:{type:String,default:"80px"}},directives:{resize:{bind:function(e,t){var a="",n="";function i(){var i=document.defaultView.getComputedStyle(e);a===i.width&&n===i.height||t.value(),a=i.width,n=i.height}e.__vueSetInterval__=setInterval(i,100)},unbind:function(e){clearInterval(e.__vueSetInterval__)}}},data:function(){return{defaultForm:{},form:{},showOpen:!1,open:!1}},watch:{value:{deep:!0,handler:function(e){this.form=Object.assign(this.form,e)}},columns:{deep:!0,handler:function(){this.resetForm()}},form:{deep:!0,handler:function(){this.$emit("input",this.form)}},open:function(){this.setHeight()}},created:function(){this.resetForm(),this.defaultForm=Object.assign({},this.form)},mounted:function(){this.$emit("input",this.form)},methods:{resetForm:function(){var e={};this.columns&&this.columns.length&&this.columns.forEach((function(t){t.props||(t.props={}),r[t.type]||(r[t.type]={}),t.props=Object.assign(t.props,r[t.type]),e[t.prop]=""})),this.form=Object.assign(e,this.value)},formResize:function(){this.$refs["form-box"]&&this.$refs["form-box"].clientHeight>60?(this.showOpen=!0,this.setHeight()):this.showOpen=!1},setHeight:function(){this.$refs["search-form"].style.height=this.open?this.$refs["form-box"].clientHeight+"px":"40px"},reset:function(){this.form=Object.assign({},this.defaultForm),this.$emit("reset",this.form)},search:function(){this.$emit("search",this.form)}}},c=l,u=(a("c41a"),a("2877")),d=Object(u["a"])(c,n,i,!1,null,"c04e5e04",null);t["a"]=d.exports},"7d77":function(e,t,a){"use strict";a("b35a")},8215:function(e,t,a){"use strict";a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return s})),a.d(t,"c",(function(){return o}));var n=a("afaa"),i=function(e){return Object(n["a"])({url:"/api-customer/community/evaluate/list",method:"GET",params:e})},s=function(e){return Object(n["a"])({url:"/api-customer/community/evaluate/listAll",method:"GET",params:e})},o=function(e){return Object(n["a"])({method:"PUT",url:"/api-customer/community/evaluate/update",data:e})}},9306:function(e,t,a){"use strict";a.d(t,"d",(function(){return i})),a.d(t,"c",(function(){return s})),a.d(t,"a",(function(){return o})),a.d(t,"e",(function(){return r})),a.d(t,"b",(function(){return l}));var n=a("afaa"),i=function(e){return Object(n["a"])({url:"/api-customer/community/keyword/list",method:"GET",params:e})},s=function(e){return Object(n["a"])({url:"/api-customer/community/keyword/getAll",method:"GET",params:e})},o=function(e){return Object(n["a"])({method:"POST",url:"/api-customer/community/keyword/add",data:e})},r=function(e){return Object(n["a"])({method:"PUT",url:"/api-customer/community/keyword/update",data:e})},l=function(e){return Object(n["a"])({method:"DELETE",url:"/api-customer/community/keyword/delete?id=".concat(e.id)})}},af68:function(e,t,a){},b35a:function(e,t,a){},b9de:function(e,t,a){},c41a:function(e,t,a){"use strict";a("af68")},ed08:function(e,t,a){"use strict";a.d(t,"b",(function(){return l})),a.d(t,"a",(function(){return u}));a("96cf");var n=a("1da1"),i=a("afaa"),s=function(e){return Object(i["a"])({url:"/api-customer/entity/typeList/".concat(e.typeCode),method:"GET"})},o=function(e){return Object(i["a"])({url:"/api-customer/entity/typeList/getChildren/".concat(e.typeCode),method:"GET"})},r={CASE_REASON:20,CASE_DIMENSION:10,COMMUNITY_LEVEL:11,COMMUNITY_TYPE:12,PROJECT_NATURE:13};function l(e){return c.apply(this,arguments)}function c(){return c=Object(n["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,s({typeCode:r[t]});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),c.apply(this,arguments)}function u(e){return d.apply(this,arguments)}function d(){return d=Object(n["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,o({typeCode:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),d.apply(this,arguments)}}}]);
//# sourceMappingURL=chunk-38e2191c.457d9681.js.map