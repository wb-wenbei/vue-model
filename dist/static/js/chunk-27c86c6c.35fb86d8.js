(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-27c86c6c"],{6208:function(e,t,n){"use strict";var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"table-search"},[n("div",{directives:[{name:"resize",rawName:"v-resize",value:e.formResize,expression:"formResize"}],ref:"search-form",staticClass:"search-form"},[n("div",{ref:"form-box"},[e._t("default",[n("el-form",{ref:"form",attrs:{model:e.form,inline:!0,"label-width":e.labelWidth}},[e._l(e.columns,(function(t,o){return n("el-form-item",{key:o,attrs:{label:t.label,"label-width":t.labelWidth}},["org"===t.type?n("form-organize",{model:{value:e.form[t.prop],callback:function(n){e.$set(e.form,t.prop,n)},expression:"form[column.prop]"}}):"input"===t.type?n("el-input",e._b({staticClass:"short-width",model:{value:e.form[t.prop],callback:function(n){e.$set(e.form,t.prop,n)},expression:"form[column.prop]"}},"el-input",t.props,!1)):"select"===t.type?n("form-select",e._b({staticClass:"search-select-item",attrs:{options:t.options},model:{value:e.form[t.prop],callback:function(n){e.$set(e.form,t.prop,n)},expression:"form[column.prop]"}},"form-select",t.props,!1)):"date"===t.type||"dateRange"===t.type?n("el-date-picker",e._b({style:{width:"date"===t.type?"215px":""},model:{value:e.form[t.prop],callback:function(n){e.$set(e.form,t.prop,n)},expression:"form[column.prop]"}},"el-date-picker",t.props,!1)):e._t(t.prop,null,{form:e.form})],2)})),e._t("default")],2)])],2)]),n("div",{staticClass:"search-btn"},[e._t("search-btn",[n("el-button",{attrs:{type:"primary"},on:{click:e.search}},[e._v("查 询")]),e.resettable?n("el-button",{on:{click:e.reset}},[e._v("重 置")]):e._e()]),e.showOpen?[!1===e.open?n("el-button",{attrs:{type:"text"},on:{click:function(t){e.open=!0}}},[e._v(" 展开 "),n("i",{staticClass:"el-icon-arrow-down"})]):e._e(),!0===e.open?n("el-button",{attrs:{type:"text"},on:{click:function(t){e.open=!1}}},[e._v(" 收起 "),n("i",{staticClass:"el-icon-arrow-up"})]):e._e()]:e._e()],2)])},a=[],i=(n("4160"),n("159b"),n("2422")),s=n("8604"),r={input:{placeholder:"请输入"},select:{placeholder:"请选择",clearable:!0},date:{placeholder:"选择日期",valueFormat:"timestamp",type:"date"},dateRange:{placeholder:"选择日期",valueFormat:"timestamp",type:"daterange",rangeSeparator:"至",startPlaceholder:"开始日期",endPlaceholder:"结束日期"}},c={name:"tableSearch",components:{FormSelect:i["a"],FormOrganize:s["a"]},props:{value:{},columns:{type:Array},resettable:{type:Boolean,default:!1},labelWidth:{type:String,default:"80px"}},directives:{resize:{bind:function(e,t){var n="",o="";function a(){var a=document.defaultView.getComputedStyle(e);n===a.width&&o===a.height||t.value(),n=a.width,o=a.height}e.__vueSetInterval__=setInterval(a,100)},unbind:function(e){clearInterval(e.__vueSetInterval__)}}},data:function(){return{defaultForm:{},form:{},showOpen:!1,open:!1}},watch:{value:{deep:!0,handler:function(e){this.form=Object.assign(this.form,e)}},columns:{deep:!0,handler:function(){this.resetForm()}},form:{deep:!0,handler:function(){this.$emit("input",this.form)}},open:function(){this.setHeight()}},created:function(){this.resetForm(),this.defaultForm=Object.assign({},this.form)},mounted:function(){this.$emit("input",this.form)},methods:{resetForm:function(){var e={};this.columns&&this.columns.length&&this.columns.forEach((function(t){t.props||(t.props={}),r[t.type]||(r[t.type]={}),t.props=Object.assign(t.props,r[t.type]),e[t.prop]=""})),this.form=Object.assign(e,this.value)},formResize:function(){this.$refs["form-box"]&&this.$refs["form-box"].clientHeight>60?(this.showOpen=!0,this.setHeight()):this.showOpen=!1},setHeight:function(){this.$refs["search-form"].style.height=this.open?this.$refs["form-box"].clientHeight+"px":"40px"},reset:function(){this.form=Object.assign({},this.defaultForm),this.$emit("reset",this.form)},search:function(){this.$emit("search",this.form)}}},u=c,m=(n("c41a"),n("2877")),l=Object(m["a"])(u,o,a,!1,null,"c04e5e04",null);t["a"]=l.exports},"6cde":function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tabs-box"},[n("common-table",{ref:"table",attrs:{headers:e.headers,api:e.pageAPI,selection:"",params:e.params,"can-add":!1,"can-delete-batch":!1,deleteApi:e.deleteAPI,uploadURL:e.uploadURL,modelUrl:e.modelUrl,settings:["setting","upload"]},on:{editRow:e.editRow},scopedSlots:e._u([{key:"table-header",fn:function(){return[n("table-search",{attrs:{resettable:"",labelWidth:"90px",columns:e.searchColumns},on:{search:e.search},model:{value:e.params,callback:function(t){e.params=t},expression:"params"}})]},proxy:!0},{key:"table-select-box",fn:function(t){var o=t.selects;return[o.length>0?n("span",{on:{click:function(t){return e.submitBatch(o)}}},[e._v("批量提交")]):e._e()]}}])}),e.visibleDialog?n("edit-dialog",{attrs:{visibleDialog:e.visibleDialog,title:e.title,columns:e.columns,loading:e.loading,form:e.form},on:{"update:visibleDialog":function(t){e.visibleDialog=t},"update:visible-dialog":function(t){e.visibleDialog=t},formUpdate:e.formUpdate,save:e.submit},scopedSlots:e._u([{key:"caseAddress",fn:function(t){var o=t.form;return[n("span",{staticStyle:{display:"inline-block","margin-right":"10px"}},[e._v(" 上海市 上海市 闵行区 ")]),n("el-input",{staticClass:"short-width",attrs:{placeholder:"请输入案件地址"},model:{value:o.caseAddress,callback:function(t){e.$set(o,"caseAddress",t)},expression:"form.caseAddress"}})]}}],null,!1,2129069083)}):e._e()],1)},a=[],i=(n("99af"),n("4160"),n("d81d"),n("b0c0"),n("d3b7"),n("ac1f"),n("841c"),n("159b"),n("2909")),s=(n("96cf"),n("1da1")),r=n("1892"),c=n("ddde"),u=n("6208"),m=n("79b1"),l=n("afaa"),p=function(e){return Object(l["a"])({url:"/api-customer/community/caseManagementMatch/page",method:"GET",params:e})},d=function(e){return Object(l["a"])({method:"PUT",url:"/api-customer/community/caseManagementMatch/update",data:e})},h=function(e){return Object(l["a"])({method:"DELETE",url:"/api-customer/community/caseManagementMatch/delete?id=".concat(e.id)})},f=function(e){return Object(l["a"])({method:"POST",url:"/api-customer/community/caseManagementMatch/commit",data:e})},b=n("e419"),y=n("ed08"),g={name:"Case",components:{CommonTable:r["a"],EditDialog:c["a"],TableSearch:u["a"]},data:function(){return{pageAPI:p,deleteAPI:h,visibleDialog:!1,loading:!1,type:"add",title:"新增案件",modelUrl:"",uploadURL:"/api-customer/community/caseManagementMatch/import",case:[],params:{},dimensionTree:[],headers:[{prop:"index",label:"序号"},{prop:"caseNumber",label:"接警单编号"},{prop:"caseDimensionName",label:"案件维度"},{prop:"caseReasonName",label:"一级案由"},{prop:"subCaseReasonName",label:"二级案由"},{prop:"caseTime",label:"报案时间",type:"date"},{prop:"match",label:"匹配结果",filter:function(e){return e?"有结果":"无结果"}},{prop:"communityTypeName",label:"社区类型"},{prop:"communityName",label:"社区名称"},{prop:"action",label:"操作",width:100,fixed:"right"}],commonOptions:{communityTypes:[],communities:[]},searchOptions:{caseDimensions:[],caseReasons:[],subCaseReasons:[]},form:{},formData:{}}},computed:{searchColumns:function(){return[{prop:"caseNumber",label:"接警单编号",type:"input"},{prop:"caseDimension",label:"案件维度",type:"select",options:this.searchOptions.caseDimensions},{prop:"caseReasonId",label:"一级案由",type:"select",options:this.searchOptions.caseReasons},{prop:"subCaseReasonId",label:"二级案由",type:"select",options:this.searchOptions.subCaseReasons},{prop:"communityId",label:"社区名称",type:"select",options:this.commonOptions.communities}]},columns:function(){return[{prop:"communityTypeId",label:"社区类型",type:"select",required:!0,options:this.commonOptions.communityTypes},{prop:"communityId",label:"社区名称",type:"select",required:!0,options:this.commonOptions.communities}]}},watch:{"params.caseDimension":function(e){this.dimensionChange(e)},"params.caseReasonId":function(e){this.caseReasonChange(e)},"formData.communityTypeId":function(e,t){this.getCommunities(e,t)}},created:function(){this.getOptions();var e=this.$store.state.auth.token;this.modelUrl="/api-customer/community/caseManagementMatch/downloadTemplate?token=".concat(e)},methods:{getOptions:function(){this.getTypes(),this.getCaseDimensions(),this.getCommunities()},getTypes:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(y["d"])("COMMUNITY_TYPE");case 2:e.commonOptions.communityTypes=t.sent;case 3:case"end":return t.stop()}}),t)})))()},getCaseDimensions:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(m["d"])();case 2:e.dimensionTree=t.sent,e.searchOptions.caseDimensions=(e.dimensionTree||[]).map((function(e){return{id:e.code,name:e.name}}));case 4:case"end":return t.stop()}}),t)})))()},getCommunities:function(e,t){var n=this;return Object(s["a"])(regeneratorRuntime.mark((function o(){return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return t&&(n.formData.communityId=""),o.next=3,Object(b["c"])({type:e});case 3:n.commonOptions.communities=o.sent;case 4:case"end":return o.stop()}}),o)})))()},search:function(){this.$refs.table.onQuery()},editRow:function(e){this.type="edit",this.title="编辑案件匹配",this.formData={},this.form=Object.assign({},e),this.visibleDialog=!0},submit:function(e){var t=this,n={id:e.id,communityTypeId:e.communityTypeId,communityId:e.communityId,communityName:this.getNameById(e.communityId,this.commonOptions.communities)};this.checkForm(n)&&(this.loading=!0,d(n).then((function(){t.$message.success("".concat(t.title,"成功！")),t.visibleDialog=!1,t.$refs.table.refresh()})).catch((function(e){t.$message.error("".concat(t.title,"失败：").concat(e))})).finally((function(){t.loading=!1})))},submitBatch:function(e){var t=this;this.$confirm("确定要提交至案件管理？").then((function(){f(e).then((function(){t.$message.success("提交成功！"),t.search()})).catch((function(e){t.$message.error("提交失败："+e)}))}))},checkForm:function(e){if(e)return!0},formUpdate:function(e){this.formData=e},dimensionChange:function(e){this.params.caseReasonId="",this.params.subCaseReasonId="",this.searchOptions.caseReasons=this.getTreeChildByCode(e,1)},caseReasonChange:function(e){this.params.subCaseReasonId="",this.searchOptions.subCaseReasons=this.getTreeChildByCode(e,2)},getTreeChildByCode:function(e,t){if(!e&&0!==e)return[];var n=[];switch(t){case 1:n=this.dimensionTree;break;case 2:(this.dimensionTree||[]).forEach((function(e){var t;(t=n).push.apply(t,Object(i["a"])(e.child||[]))}));break}var o=[];return n.forEach((function(t){e===t.code&&(o=(t.child||[]).map((function(e){return{id:e.code,name:e.name}})))})),o},getNameById:function(e,t){var n="--";return t.forEach((function(t){t.id===e&&(n=t.name)})),n}}},v=g,O=n("2877"),w=Object(O["a"])(v,o,a,!1,null,null,null);t["default"]=w.exports},"79b1":function(e,t,n){"use strict";n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return i})),n.d(t,"e",(function(){return s})),n.d(t,"b",(function(){return r})),n.d(t,"d",(function(){return c}));var o=n("afaa"),a=function(e){return Object(o["a"])({url:"/api-customer/community/case/list",method:"GET",params:e})},i=function(e){return Object(o["a"])({method:"POST",url:"/api-customer/community/case/add",data:e})},s=function(e){return Object(o["a"])({method:"PUT",url:"/api-customer/community/case/update",data:e})},r=function(e){return Object(o["a"])({method:"DELETE",url:"/api-customer/community/case/delete?id=".concat(e.id)})},c=function(e){return Object(o["a"])({method:"GET",url:"/api-customer/community/queryCaseDimensions/cascade",params:e})}},af68:function(e,t,n){},c41a:function(e,t,n){"use strict";n("af68")},e419:function(e,t,n){"use strict";n.d(t,"d",(function(){return a})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return s})),n.d(t,"f",(function(){return r})),n.d(t,"b",(function(){return c})),n.d(t,"e",(function(){return u}));var o=n("afaa"),a=function(e){return Object(o["a"])({url:"/api-customer/service-wisdom-town/community/list",method:"GET",params:e})},i=function(e){return Object(o["a"])({url:"/api-customer/service-wisdom-town/community/getAll",method:"GET",params:e})},s=function(e){return Object(o["a"])({method:"POST",url:"/api-customer/service-wisdom-town/community/add",data:e})},r=function(e){return Object(o["a"])({method:"PUT",url:"/api-customer/service-wisdom-town/community/update",data:e})},c=function(e){return Object(o["a"])({method:"DELETE",url:"/api-customer/service-wisdom-town/community/delete?id=".concat(e.id)})},u=function(e){return Object(o["a"])({url:"/api-customer/service-wisdom-town/community/queryPolice",method:"GET",params:e})}}}]);
//# sourceMappingURL=chunk-27c86c6c.35fb86d8.js.map