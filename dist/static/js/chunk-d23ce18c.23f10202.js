(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d23ce18c"],{"5d6c":function(e,t,n){},"846a":function(e,t,n){},a8a8:function(e,t,n){"use strict";n("5d6c")},d322:function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tabs-box"},[n("common-table",{ref:"table",attrs:{headers:e.headers,api:e.pageAPI,deleteApi:e.deleteAPI,settings:["setting"]},on:{editRow:e.editRow,add:e.add}}),e.visibleDialog?n("edit-dialog",{attrs:{visibleDialog:e.visibleDialog,title:e.title,columns:e.columns,loading:e.loading,form:e.form},on:{"update:visibleDialog":function(t){e.visibleDialog=t},"update:visible-dialog":function(t){e.visibleDialog=t},save:e.submit},scopedSlots:e._u([{key:"menuDtos",fn:function(){return[n("el-form-item",{staticStyle:{"padding-top":"5px"},attrs:{label:"角色权限",required:""}},[n("select-group",{attrs:{menuOptionsOrg:e.totalMenus,mactchMenus:e.matchMenu},model:{value:e.menuDtos,callback:function(t){e.menuDtos=t},expression:"menuDtos"}})],1)]},proxy:!0}],null,!1,3822885382)}):e._e()],1)},i=[],s=(n("99af"),n("4160"),n("b0c0"),n("d3b7"),n("ac1f"),n("5319"),n("159b"),n("1892")),c=n("ddde"),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"select-group"},e._l(e.menuOptions,(function(t){return n("div",{key:t.code,staticClass:"select-group-item"},[n("el-checkbox",{attrs:{indeterminate:t.isIndeterminate},on:{change:function(n){return e.handleCheckAllChange(n,t)}},model:{value:t.check,callback:function(n){e.$set(t,"check",n)},expression:"menuItem.check"}},[e._v(e._s(t.name))]),t.sonMenus&&t.sonMenus.length?n("el-checkbox-group",{on:{change:function(n){return e.handleCheckedSingleChange(n,t)}},model:{value:t.checkArr,callback:function(n){e.$set(t,"checkArr",n)},expression:"menuItem.checkArr"}},e._l(t.sonMenus,(function(t){return n("el-checkbox",{key:t.id,attrs:{label:t}},[e._v(e._s(e.getFilterName(t.name)))])})),1):e._e()],1)})),0)},r=[],u=(n("d81d"),n("caad"),n("c975"),n("2532"),n("2909")),l=function e(t){var n=[];return t.forEach((function(t){t.children&&t.children.length?n.push.apply(n,Object(u["a"])(e(t.children))):t.sonMenus&&t.sonMenus.length&&n.push.apply(n,Object(u["a"])(e(t.sonMenus))),n.push(t)})),n},h=function e(t,n){var o=[];return t.forEach((function(t){var i,s,c={code:t.index||t.code,name:t.navName||t.name,sonMenus:[],businessCode:1,imgUrl:null,description:null,check:!1,isIndeterminate:!1,checkArr:[]};t.children&&(i=c.sonMenus).push.apply(i,Object(u["a"])(e(t.children,n)));t.sonMenus&&(s=c.sonMenus).push.apply(s,Object(u["a"])(e(t.sonMenus,n)));c.sonMenus.forEach((function(e){e.check&&c.checkArr.push(e)})),n.forEach((function(e){e.code!==t.index&&e.code!==t.code||(c.check=!0,c.name=e.name,c.sonMenus.length&&(c.check=c.sonMenus.length===c.checkArr.length,c.isIndeterminate=c.sonMenus.length!==c.checkArr.length))})),o.push(c)})),o},d=function(e,t){var n=l(t),o=h(e,n);return o},m=function(e){var t=[],n=JSON.parse(JSON.stringify(e));return n.forEach((function(e){if(e.check||e.checkArr.length){var n={code:e.code,name:e.name,sonMenus:e.checkArr,businessCode:1,imgUrl:null,description:null};t.push(n)}})),t},p={props:{menuOptionsOrg:{type:Array,default:function(){return[]}},mactchMenus:{type:Array,default:function(){return[]}},value:{type:Array,default:function(){return[]}}},model:{prop:"value",event:"exportEvent"},created:function(){this.menuOptions=d(this.menuOptionsOrg,this.mactchMenus)},data:function(){return{menuOptions:[]}},mounted:function(){this.$nextTick(this.export)},methods:{handleCheckAllChange:function(e,t){t.checkArr=e?t.sonMenus.map((function(e){return e})):[],t.isIndeterminate=!1,this.export()},handleCheckedSingleChange:function(e,t){var n=e.length;t.check=n===t.sonMenus.length,t.isIndeterminate=n>0&&n<t.sonMenus.length,this.export()},export:function(){this.$emit("exportEvent",m(this.menuOptions))},getFilterName:function(e){return e.replace("虹桥-","")}}},f=p,g=(n("a8a8"),n("2877")),b=Object(g["a"])(f,a,r,!1,null,"b907ee76",null),v=b.exports,k=n("afaa"),M=function(e){return Object(k["a"])({url:"/api-customer/account/web/rolesWithPage",method:"GET",params:e})},O=function(e){return Object(k["a"])({method:"delete",url:"/api-customer/account/web/role?roleId=".concat(e.id)})},x=function(e){return Object(k["a"])({method:"POST",url:"/api-customer/account/web/role",data:e})},y=function(e){return Object(k["a"])({method:"PUT",url:"/api-customer/account/web/role",data:e})},D=function(){return Object(k["a"])({method:"get",url:"/api-customer/account/web/menus/my"})},A=function(){return Object(k["a"])({method:"GET",url:"/api-customer/account/web/roles"})},w={name:"Roles",components:{CommonTable:s["a"],EditDialog:c["a"],SelectGroup:v},data:function(){return{pageAPI:M,deleteAPI:O,activeName:"roles",visibleDialog:!1,loading:!1,type:"add",title:"新增角色",roles:[],totalMenus:[],matchMenu:[],headers:[{prop:"index",label:"序号"},{prop:"name",label:"角色名称",width:"200px"},{prop:"menuDtos",label:"角色权限",filter:this.getMenus},{prop:"action",label:"操作",width:140,fixed:"right"}],columns:[{prop:"name",label:"角色名称",type:"text",required:!0},{prop:"menuDtos",label:"角色权限",type:"custom",required:!0,cols:4}],menuDtos:[],form:{name:"",menuDtos:[]},props:{children:"sonMenus",label:"name",value:"id"}}},created:function(){this.getRoles(),this.getRoleMenus()},methods:{getRoles:function(){var e=this;A().then((function(t){e.roles=t}))},getRoleMenus:function(){var e=this;D().then((function(t){e.totalMenus=t||[]}))},editRow:function(e){this.type="edit",this.title="编辑角色",this.form=e,this.matchMenu=e.menuDtos,this.visibleDialog=!0},add:function(){this.type="add",this.title="新增角色",this.form={},this.matchMenu=[],this.visibleDialog=!0},submit:function(e){var t=this;if(this.menuDtos.length){var n=Object.assign(e,{menuDtos:this.menuDtos}),o="add"===this.type?x:y;this.loading=!0,o(n).then((function(){t.$message.success("".concat(t.title,"成功！")),t.visibleDialog=!1,t.$refs.table.refresh()})).catch((function(e){t.$message.error("".concat(t.title,"失败：").concat(e))})).finally((function(){t.loading=!1}))}else this.$message.error("请选择角色权限！")},getMenus:function(e){var t=[];return e.forEach((function(e){t.push(e.name.replace("虹桥-",""))})),t.toString()}}},C=w,j=(n("e18d"),Object(g["a"])(C,o,i,!1,null,"1fed8f9a",null));t["default"]=j.exports},e18d:function(e,t,n){"use strict";n("846a")}}]);
//# sourceMappingURL=chunk-d23ce18c.23f10202.js.map